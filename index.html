<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>SPIKY PRO - منصة البث الترفيهي</title>
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&family=Montserrat:wght@700;800;900&family=Poppins:wght@600;700;800&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #E50914;
            --primary-dark: #B2070F;
            --bg-dark: #0F0F0F;
            --bg-light: #F5F5F5;
            --card-dark: #1A1A1A;
            --card-light: #FFFFFF;
            --text-dark: #FFFFFF;
            --text-light: #0F0F0F;
            --gray: #2A2A2A;
            --light-gray: #E0E0E0;
            --transition: all 0.3s ease;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-dark);
            font-family: 'Roboto', 'Cairo', sans-serif;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
            min-height: 100vh;
        }

        /* Light Theme */
        body.light-theme {
            background-color: var(--bg-light);
            color: var(--text-light);
        }

        body.light-theme .header,
        body.light-theme .card,
        body.light-theme .details-container,
        body.light-theme .video-player-section,
        body.light-theme .filter-section,
        body.light-theme .list-section,
        body.light-theme .dashboard-panel {
            background-color: var(--card-light);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        body.light-theme .card p,
        body.light-theme .card h3 {
            color: var(--text-light);
        }

        body.light-theme .list-item {
            background-color: var(--light-gray);
        }

        /* Header - محسن للهواتف */
        .header {
            background-color: rgba(15, 15, 15, 0.98);
            backdrop-filter: blur(10px);
            padding: 0.8rem 1rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            transition: var(--transition);
            width: 100%;
        }

        .logo {
            font-family: 'Montserrat', 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 5px;
            cursor: pointer;
        }

        .logo span {
            font-size: 1.8rem;
            filter: drop-shadow(0 0 5px var(--primary));
            transform: rotate(-10deg);
            display: inline-block;
            animation: spikeGlow 2s infinite;
        }

        @keyframes spikeGlow {
            0%, 100% { filter: drop-shadow(0 0 5px var(--primary)); }
            50% { filter: drop-shadow(0 0 12px var(--primary)); }
        }

        /* القائمة المتنقلة للهواتف */
        .nav-menu {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        @media (max-width: 768px) {
            .nav-menu {
                display: none;
                position: absolute;
                top: 100%;
                left: 0;
                right: 0;
                background-color: var(--bg-dark);
                flex-direction: column;
                padding: 1rem;
                gap: 1rem;
                border-bottom: 2px solid var(--primary);
                box-shadow: 0 5px 10px rgba(0,0,0,0.5);
            }

            .nav-menu.active {
                display: flex;
            }

            .header {
                padding: 0.5rem 1rem;
            }

            .logo {
                font-size: 1.3rem;
            }

            .logo span {
                font-size: 1.5rem;
            }
        }

        .nav-menu a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: var(--transition);
            position: relative;
            padding: 0.5rem 0;
        }

        .nav-menu a:hover,
        .nav-menu a.active {
            color: var(--primary);
        }

        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s;
        }

        .nav-menu a:hover::after,
        .nav-menu a.active::after {
            width: 100%;
        }

        /* مربع البحث - محسن للهواتف */
        .search-box {
            display: flex;
            align-items: center;
            background-color: var(--gray);
            border-radius: 25px;
            padding: 0.2rem 0.2rem 0.2rem 0.8rem;
            border: 1px solid var(--primary);
        }

        @media (max-width: 480px) {
            .search-box {
                max-width: 140px;
            }
            
            .search-box input {
                width: 100px;
            }
        }

        .search-box input {
            background: transparent;
            border: none;
            color: var(--text-dark);
            padding: 0.4rem;
            width: 180px;
            outline: none;
            font-size: 0.85rem;
        }

        .search-box input::placeholder {
            color: #888;
        }

        .search-box button {
            background-color: var(--primary);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .search-box button:hover {
            transform: scale(1.1);
        }

        .theme-toggle,
        .user-dashboard-toggle,
        .hamburger {
            background: var(--gray);
            border: 1px solid var(--primary);
            color: white;
            width: 38px;
            height: 38px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.1rem;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover,
        .user-dashboard-toggle:hover,
        .hamburger:hover {
            background-color: var(--primary);
            transform: rotate(5deg);
        }

        .hamburger {
            display: none;
        }

        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
        }

        /* Main Content - محسن للهواتف */
        .main-content {
            padding: 1rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        @media (min-width: 768px) {
            .main-content {
                padding: 2rem;
            }
        }

        .section-title {
            font-family: 'Poppins', 'Montserrat', sans-serif;
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            margin: 1.5rem 0 1rem;
            position: relative;
            padding-right: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 2rem;
                margin: 2rem 0 1.5rem;
                padding-right: 20px;
            }
        }

        .section-title::before {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 30px;
            background-color: var(--primary);
            border-radius: 5px;
        }

        @media (min-width: 768px) {
            .section-title::before {
                width: 5px;
                height: 40px;
            }
        }

        .view-all {
            color: var(--primary);
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: normal;
        }

        /* Cards Grid - محسن للهواتف */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 480px) {
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
            }
        }

        @media (min-width: 768px) {
            .cards-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 1.2rem;
            }
        }

        @media (min-width: 1024px) {
            .cards-grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 1.5rem;
            }
        }

        @media (min-width: 1280px) {
            .cards-grid {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        .card {
            background-color: var(--card-dark);
            border-radius: 8px;
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            width: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3);
        }

        .card-poster {
            position: relative;
            aspect-ratio: 2/3;
            overflow: hidden;
        }

        .card-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }

        .card:hover .card-poster img {
            transform: scale(1.05);
        }

        .card-rating {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: var(--primary);
            color: white;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-weight: bold;
            font-size: 0.7rem;
            z-index: 2;
        }

        @media (min-width: 768px) {
            .card-rating {
                top: 10px;
                left: 10px;
                padding: 0.3rem 0.6rem;
                font-size: 0.9rem;
            }
        }

        .card-year {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            padding: 0.15rem 0.3rem;
            border-radius: 3px;
            font-size: 0.65rem;
            z-index: 2;
        }

        @media (min-width: 768px) {
            .card-year {
                bottom: 10px;
                right: 10px;
                padding: 0.2rem 0.5rem;
                font-size: 0.8rem;
            }
        }

        .card-info {
            padding: 0.5rem;
        }

        @media (min-width: 768px) {
            .card-info {
                padding: 0.8rem;
            }
        }

        .card-info h3 {
            font-size: 0.8rem;
            margin-bottom: 0.2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @media (min-width: 768px) {
            .card-info h3 {
                font-size: 1rem;
                margin-bottom: 0.3rem;
            }
        }

        .card-info p {
            font-size: 0.65rem;
            color: #aaa;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        @media (min-width: 768px) {
            .card-info p {
                font-size: 0.8rem;
                gap: 5px;
            }
        }

        /* Filter Section - محسن للهواتف */
        .filter-section {
            background-color: var(--card-dark);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            align-items: center;
        }

        @media (max-width: 480px) {
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .filter-group select,
            .filter-group input {
                width: 100%;
            }
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            color: var(--primary);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .filter-group select,
        .filter-group input {
            background-color: var(--gray);
            border: 1px solid var(--primary);
            color: inherit;
            padding: 0.5rem;
            border-radius: 5px;
            outline: none;
            font-size: 0.9rem;
            flex: 1;
        }

        .filter-group input[type="range"] {
            min-width: 120px;
        }

        .apply-filters {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.3s;
            white-space: nowrap;
        }

        .apply-filters:hover {
            transform: scale(1.05);
        }

        /* Video Player - محسن للهواتف */
        .video-player-section {
            background-color: var(--card-dark);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 768px) {
            .video-player-section {
                padding: 1.5rem;
            }
        }

        .video-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background-color: black;
            border-radius: 8px;
            overflow: hidden;
        }

        #main-video-player {
            width: 100%;
            height: 100%;
            background-color: black;
        }

        .video-controls {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            align-items: center;
            justify-content: space-between;
        }

        @media (max-width: 480px) {
            .video-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .quality-selector,
            .server-selector,
            .subtitle-selector {
                width: 100%;
            }
            
            .quality-selector select,
            .server-selector select,
            .subtitle-selector select {
                width: 100%;
            }
        }

        .quality-selector,
        .server-selector,
        .subtitle-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .quality-selector select,
        .server-selector select,
        .subtitle-selector select {
            background-color: var(--gray);
            border: 1px solid var(--primary);
            color: inherit;
            padding: 0.5rem;
            border-radius: 5px;
            outline: none;
            font-size: 0.9rem;
        }

        /* User Lists - محسن للهواتف */
        .user-lists {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 640px) {
            .user-lists {
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            .user-lists {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .list-section {
            background-color: var(--card-dark);
            border-radius: 10px;
            padding: 1rem;
        }

        .list-section h3 {
            color: var(--primary);
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
        }

        .list-items {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .list-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.4rem;
            background-color: var(--gray);
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .list-item:hover {
            transform: translateX(-3px);
            background-color: var(--primary);
        }

        .list-item img {
            width: 40px;
            height: 55px;
            object-fit: cover;
            border-radius: 4px;
        }

        .list-item-info {
            flex: 1;
        }

        .list-item-info h4 {
            font-size: 0.85rem;
            margin-bottom: 0.15rem;
        }

        .list-item-info p {
            font-size: 0.7rem;
            color: #aaa;
        }

        /* Details Page - محسن للهواتف */
        .details-container {
            background-color: var(--card-dark);
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 768px) {
            .details-container {
                padding: 2rem;
            }
        }

        .details-header {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        @media (min-width: 640px) {
            .details-header {
                flex-direction: row;
                gap: 2rem;
            }
        }

        .details-poster {
            width: 100%;
            max-width: 250px;
            margin: 0 auto;
            border-radius: 10px;
            overflow: hidden;
        }

        @media (min-width: 640px) {
            .details-poster {
                width: 250px;
                margin: 0;
            }
        }

        .details-poster img {
            width: 100%;
            height: auto;
        }

        .details-info {
            flex: 1;
        }

        .details-info h1 {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 0.8rem;
        }

        @media (min-width: 768px) {
            .details-info h1 {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }
        }

        .details-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.85rem;
        }

        .meta-item i {
            color: var(--primary);
        }

        .details-actions {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .action-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 10px var(--primary);
        }

        .action-btn.secondary {
            background-color: transparent;
            border: 1px solid var(--primary);
        }

        /* Dashboard Panel - محسن للهواتف */
        .dashboard-panel {
            position: fixed;
            top: 60px;
            right: -100%;
            width: 100%;
            max-width: 350px;
            height: calc(100vh - 60px);
            background-color: var(--card-dark);
            z-index: 999;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 1rem;
            border-left: 2px solid var(--primary);
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.5);
        }

        @media (min-width: 768px) {
            .dashboard-panel {
                top: 80px;
                right: -400px;
                width: 380px;
                height: calc(100vh - 80px);
                padding: 1.5rem;
            }
        }

        .dashboard-panel.open {
            right: 0;
        }

        /* Footer */
        .footer {
            background-color: var(--card-dark);
            padding: 1.5rem 1rem;
            margin-top: 2rem;
            text-align: center;
            border-top: 2px solid var(--primary);
            font-size: 0.9rem;
        }

        @media (min-width: 768px) {
            .footer {
                padding: 2rem;
            }
        }

        /* Loading Placeholder */
        .loading-placeholder {
            background: linear-gradient(90deg, var(--card-dark) 25%, var(--gray) 50%, var(--card-dark) 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
            aspect-ratio: 2/3;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo" onclick="navigateToHome()">
            <span>⚡</span>
            SPIKY PRO
        </div>
        
        <div class="hamburger" onclick="toggleMenu()">
            <i class="fas fa-bars"></i>
        </div>

        <nav class="nav-menu" id="navMenu">
            <a href="#home" class="active" onclick="navigateTo('home')">الرئيسية</a>
            <a href="#anime" onclick="navigateTo('anime')">أنمي</a>
            <a href="#movies" onclick="navigateTo('movies')">أفلام</a>
            <a href="#tvshows" onclick="navigateTo('tvshows')">مسلسلات</a>
            <a href="#categories" onclick="navigateTo('categories')">التصنيفات</a>
            <a href="#search" onclick="navigateTo('search')">البحث</a>
        </nav>

        <div style="display: flex; gap: 0.3rem; align-items: center;">
            <div class="search-box">
                <input type="text" placeholder="بحث..." id="searchInput" onkeypress="handleSearchKeyPress(event)">
                <button onclick="performSearch()"><i class="fas fa-search"></i></button>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
            <button class="user-dashboard-toggle" onclick="toggleDashboard()">
                <i class="fas fa-user"></i>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" id="mainContent"></main>

    <!-- Footer -->
    <footer class="footer">
        <p>جميع الحقوق محفوظة &copy; 2025 SPIKY PRO</p>
    </footer>

    <script>
        // TMDB API Configuration
        const TMDB_API_KEY = '0bda9e22b1964edefad1122760cf66a5';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';
        const VIDEO_BASE_URL = 'https://vidsrc.xyz/embed/'; // خدمة مجانية لتشغيل الفيديوهات

        // App State
        let currentPage = 'home';
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let watchHistory = JSON.parse(localStorage.getItem('watchHistory')) || [];
        let userSettings = JSON.parse(localStorage.getItem('userSettings')) || {
            theme: 'dark',
            defaultQuality: '1080p'
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            loadHomePage();
        });

        // Apply Theme
        function applyTheme() {
            if (userSettings.theme === 'light') {
                document.body.classList.add('light-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i>';
            } else {
                document.body.classList.remove('light-theme');
                document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i>';
            }
        }

        // Toggle Theme
        function toggleTheme() {
            userSettings.theme = userSettings.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('userSettings', JSON.stringify(userSettings));
            applyTheme();
        }

        // Toggle Menu
        function toggleMenu() {
            document.getElementById('navMenu').classList.toggle('active');
        }

        // Toggle Dashboard
        function toggleDashboard() {
            // يمكن إضافة لوحة المستخدم لاحقاً
            alert('قريباً: لوحة المستخدم');
        }

        // Navigation
        function navigateTo(page) {
            currentPage = page;
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            event.target.classList.add('active');
            
            switch(page) {
                case 'home':
                    loadHomePage();
                    break;
                case 'anime':
                    loadCategoryPage('tv', 16, 'أنمي');
                    break;
                case 'movies':
                    loadCategoryPage('movie', null, 'أفلام');
                    break;
                case 'tvshows':
                    loadCategoryPage('tv', null, 'مسلسلات');
                    break;
                case 'categories':
                    loadCategoriesPage();
                    break;
                case 'search':
                    loadSearchPage();
                    break;
            }
            
            // Close menu on mobile after navigation
            if (window.innerWidth <= 768) {
                document.getElementById('navMenu').classList.remove('active');
            }
        }

        function navigateToHome() {
            currentPage = 'home';
            loadHomePage();
        }

        // Load Home Page
        async function loadHomePage() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="section-title">
                    أحدث الإضافات
                    <a href="#" class="view-all" onclick="navigateTo('search')">عرض الكل</a>
                </div>
                <div class="cards-grid" id="latestContent">
                    ${Array(6).fill('<div class="loading-placeholder"></div>').join('')}
                </div>

                <div class="section-title">
                    الأعمال الشائعة
                    <a href="#" class="view-all" onclick="navigateTo('search')">عرض الكل</a>
                </div>
                <div class="cards-grid" id="trendingContent">
                    ${Array(6).fill('<div class="loading-placeholder"></div>').join('')}
                </div>

                <div class="section-title">
                    أفلام رائجة
                </div>
                <div class="cards-grid" id="popularMovies">
                    ${Array(6).fill('<div class="loading-placeholder"></div>').join('')}
                </div>

                <div class="section-title">
                    مسلسلات رائجة
                </div>
                <div class="cards-grid" id="popularTVShows">
                    ${Array(6).fill('<div class="loading-placeholder"></div>').join('')}
                </div>
            `;

            // Load data
            loadLatestContent();
            loadTrendingContent();
            loadPopularMovies();
            loadPopularTVShows();
        }

        async function loadLatestContent() {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/trending/all/day?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                displayCards(data.results.slice(0, 6), 'latestContent');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadTrendingContent() {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/trending/all/week?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                displayCards(data.results.slice(0, 6), 'trendingContent');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadPopularMovies() {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/movie/popular?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                displayCards(data.results.slice(0, 6), 'popularMovies');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadPopularTVShows() {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/tv/popular?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                displayCards(data.results.slice(0, 6), 'popularTVShows');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Load Category Page
        async function loadCategoryPage(mediaType, genreId, title) {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="section-title">${title}</div>
                <div class="filter-section">
                    <div class="filter-group">
                        <label>النوع:</label>
                        <select id="genreFilter">
                            <option value="">الكل</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>السنة:</label>
                        <input type="number" id="yearFilter" placeholder="2025" min="1900" max="2025">
                    </div>
                    <button class="apply-filters" onclick="applyCategoryFilters('${mediaType}')">تطبيق</button>
                </div>
                <div class="cards-grid" id="categoryContent">
                    ${Array(12).fill('<div class="loading-placeholder"></div>').join('')}
                </div>
            `;

            loadGenres(mediaType);
            loadCategoryContent(mediaType, genreId);
        }

        async function loadGenres(mediaType) {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/genre/${mediaType}/list?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                const select = document.getElementById('genreFilter');
                data.genres.forEach(genre => {
                    select.innerHTML += `<option value="${genre.id}">${genre.name}</option>`;
                });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function loadCategoryContent(mediaType, genreId) {
            try {
                let url = `${TMDB_BASE_URL}/discover/${mediaType}?api_key=${TMDB_API_KEY}&sort_by=popularity.desc`;
                if (genreId) url += `&with_genres=${genreId}`;
                
                const response = await fetch(url);
                const data = await response.json();
                displayCards(data.results, 'categoryContent');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function applyCategoryFilters(mediaType) {
            const genre = document.getElementById('genreFilter').value;
            const year = document.getElementById('yearFilter').value;

            try {
                let url = `${TMDB_BASE_URL}/discover/${mediaType}?api_key=${TMDB_API_KEY}&sort_by=popularity.desc`;
                if (genre) url += `&with_genres=${genre}`;
                if (year) url += `&primary_release_year=${year}`;
                
                const response = await fetch(url);
                const data = await response.json();
                displayCards(data.results, 'categoryContent');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Load Categories Page
        function loadCategoriesPage() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="section-title">التصنيفات</div>
                <div class="cards-grid" id="categoriesGrid"></div>
            `;

            const categories = [
                { id: 28, name: 'أكشن', icon: 'fa-fist-raised' },
                { id: 12, name: 'مغامرة', icon: 'fa-compass' },
                { id: 16, name: 'أنمي', icon: 'fa-dragon' },
                { id: 35, name: 'كوميدي', icon: 'fa-laugh' },
                { id: 18, name: 'دراما', icon: 'fa-theater-masks' },
                { id: 27, name: 'رعب', icon: 'fa-ghost' },
                { id: 10749, name: 'رومانسي', icon: 'fa-heart' },
                { id: 878, name: 'خيال علمي', icon: 'fa-rocket' }
            ];

            const categoriesHTML = categories.map(cat => `
                <div class="card" onclick="navigateToGenre(${cat.id}, '${cat.name}')">
                    <div class="card-poster" style="background: linear-gradient(45deg, #E50914, #0F0F0F); display: flex; align-items: center; justify-content: center;">
                        <i class="fas ${cat.icon}" style="font-size: 2.5rem; color: white;"></i>
                    </div>
                    <div class="card-info">
                        <h3 style="text-align: center;">${cat.name}</h3>
                    </div>
                </div>
            `).join('');

            document.getElementById('categoriesGrid').innerHTML = categoriesHTML;
        }

        function navigateToGenre(genreId, genreName) {
            loadCategoryPage('movie', genreId, genreName);
        }

        // Load Search Page
        function loadSearchPage() {
            const mainContent = document.getElementById('mainContent');
            mainContent.innerHTML = `
                <div class="filter-section">
                    <input type="text" id="searchInput" placeholder="ابحث عن فيلم أو مسلسل..." style="flex: 1; padding: 0.8rem; background: var(--gray); border: 1px solid var(--primary); color: inherit; border-radius: 5px;">
                    <button class="apply-filters" onclick="performAdvancedSearch()">بحث</button>
                </div>
                <div class="cards-grid" id="searchResults"></div>
            `;
        }

        async function performAdvancedSearch() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;

            document.getElementById('searchResults').innerHTML = Array(6).fill('<div class="loading-placeholder"></div>').join('');

            try {
                const response = await fetch(`${TMDB_BASE_URL}/search/multi?api_key=${TMDB_API_KEY}&query=${encodeURIComponent(query)}`);
                const data = await response.json();
                displayCards(data.results, 'searchResults');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value;
            if (query) {
                navigateTo('search');
                setTimeout(() => {
                    document.getElementById('searchInput').value = query;
                    performAdvancedSearch();
                }, 100);
            }
        }

        function handleSearchKeyPress(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        }

        // Display Cards
        function displayCards(items, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = items.map(item => {
                const title = item.title || item.name;
                const date = item.release_date || item.first_air_date;
                const year = date ? date.split('-')[0] : 'N/A';
                const rating = item.vote_average ? item.vote_average.toFixed(1) : 'N/A';
                const type = item.media_type || (containerId.includes('movie') ? 'movie' : 'tv');
                
                return `
                    <div class="card" onclick="showDetails(${item.id}, '${type}')">
                        <div class="card-poster">
                            <img src="${item.poster_path ? IMAGE_BASE_URL + item.poster_path : 'https://via.placeholder.com/300x450?text=No+Image'}" 
                                 alt="${title}"
                                 loading="lazy">
                            <div class="card-rating"><i class="fas fa-star"></i> ${rating}</div>
                            <div class="card-year">${year}</div>
                        </div>
                        <div class="card-info">
                            <h3>${title}</h3>
                            <p><i class="fas fa-calendar"></i> ${year}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Show Details
        async function showDetails(id, type) {
            const mainContent = document.getElementById('mainContent');
            
            mainContent.innerHTML = `
                <div class="details-container">
                    <div class="loading-placeholder" style="height: 400px;"></div>
                </div>
            `;

            try {
                const response = await fetch(`${TMDB_BASE_URL}/${type}/${id}?api_key=${TMDB_API_KEY}&append_to_response=credits,videos`);
                const details = await response.json();

                const title = details.title || details.name;
                const year = (details.release_date || details.first_air_date || '').split('-')[0];
                const rating = details.vote_average ? details.vote_average.toFixed(1) : 'N/A';
                const trailer = details.videos?.results?.find(v => v.type === 'Trailer' && v.site === 'YouTube');

                mainContent.innerHTML = `
                    <div class="details-container">
                        <div class="details-header">
                            <div class="details-poster">
                                <img src="${details.poster_path ? IMAGE_BASE_URL + details.poster_path : 'https://via.placeholder.com/300x450'}" alt="${title}">
                            </div>
                            <div class="details-info">
                                <h1>${title}</h1>
                                <div class="details-meta">
                                    <span class="meta-item"><i class="fas fa-star"></i> ${rating}</span>
                                    <span class="meta-item"><i class="fas fa-calendar"></i> ${year}</span>
                                    ${details.runtime ? `<span class="meta-item"><i class="fas fa-clock"></i> ${details.runtime} دقيقة</span>` : ''}
                                </div>
                                
                                <p style="margin-bottom: 1.5rem;">${details.overview || 'لا يوجد وصف متاح'}</p>

                                <div class="details-actions">
                                    <button class="action-btn" onclick="playVideo(${id}, '${type}')">
                                        <i class="fas fa-play"></i> مشاهدة الآن
                                    </button>
                                    <button class="action-btn secondary" onclick="addToFavorites(${id}, '${title}', '${details.poster_path}', '${type}')">
                                        <i class="fas fa-heart"></i> أضف للمفضلة
                                    </button>
                                </div>

                                ${trailer ? `
                                    <button class="action-btn secondary" onclick="window.open('https://www.youtube.com/watch?v=${trailer.key}', '_blank')">
                                        <i class="fas fa-video"></i> مشاهدة التريلر
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>

                    <div class="section-title">
                        أعمال مشابهة
                    </div>
                    <div class="cards-grid" id="similarContent">
                        ${Array(6).fill('<div class="loading-placeholder"></div>').join('')}
                    </div>
                `;

                loadSimilarContent(id, type);
                addToWatchHistory(id, title, details.poster_path, type);
                
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Play Video - باستخدام روابط حقيقية
        function playVideo(id, type) {
            const mainContent = document.getElementById('mainContent');
            
            // استخدام خدمة vidsrc لتشغيل الفيديو (خدمة مجانية)
            const videoUrl = `https://vidsrc.xyz/embed/${type}/${id}`;
            
            mainContent.innerHTML = `
                <div class="video-player-section">
                    <div class="video-container">
                        <iframe 
                            id="main-video-player"
                            src="${videoUrl}" 
                            frameborder="0" 
                            allowfullscreen
                            style="width: 100%; height: 100%; border: none;"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture">
                        </iframe>
                    </div>

                    <div class="video-controls">
                        <div class="quality-selector">
                            <label>الجودة:</label>
                            <select onchange="changeVideoQuality(this.value, ${id}, '${type}')">
                                <option value="auto">تلقائي</option>
                                <option value="1080p">1080p</option>
                                <option value="720p">720p</option>
                                <option value="480p">480p</option>
                                <option value="360p">360p</option>
                            </select>
                        </div>

                        <div class="server-selector">
                            <label>السيرفر:</label>
                            <select onchange="changeVideoServer(this.value, ${id}, '${type}')">
                                <option value="vidsrc">سيرفر 1</option>
                                <option value="2embed">سيرفر 2</option>
                                <option value="autoembed">سيرفر 3</option>
                            </select>
                        </div>

                        <button class="action-btn" onclick="showDetails(${id}, '${type}')">
                            <i class="fas fa-arrow-right"></i> العودة للتفاصيل
                        </button>
                    </div>
                </div>

                <div class="section-title">
                    قد يعجبك أيضاً
                </div>
                <div class="cards-grid" id="similarContent"></div>
            `;

            loadSimilarContent(id, type);
        }

        // تغيير جودة الفيديو
        function changeVideoQuality(quality, id, type) {
            const servers = {
                vidsrc: 'https://vidsrc.xyz/embed/',
                '2embed': 'https://www.2embed.cc/embed/',
                autoembed: 'https://autoembed.cc/embed/'
            };
            
            const server = document.querySelector('.server-selector select').value;
            const videoFrame = document.getElementById('main-video-player');
            
            if (videoFrame) {
                // بعض السيرفرات تدعم باراميتر الجودة
                let url = servers[server] + `${type}/${id}`;
                if (quality !== 'auto') {
                    url += `?quality=${quality}`;
                }
                videoFrame.src = url;
            }
        }

        // تغيير سيرفر الفيديو
        function changeVideoServer(server, id, type) {
            const servers = {
                vidsrc: 'https://vidsrc.xyz/embed/',
                '2embed': 'https://www.2embed.cc/embed/',
                autoembed: 'https://autoembed.cc/embed/'
            };
            
            const videoFrame = document.getElementById('main-video-player');
            if (videoFrame) {
                videoFrame.src = servers[server] + `${type}/${id}`;
            }
        }

        async function loadSimilarContent(id, type) {
            try {
                const response = await fetch(`${TMDB_BASE_URL}/${type}/${id}/similar?api_key=${TMDB_API_KEY}`);
                const data = await response.json();
                displayCards(data.results.slice(0, 6), 'similarContent');
            } catch (error) {
                console.error('Error:', error);
            }
        }

        // Favorites Functions
        function addToFavorites(id, title, posterPath, type) {
            if (!favorites.some(f => f.id === id && f.type === type)) {
                favorites.push({ id, title, posterPath, type, date: new Date().toISOString() });
                localStorage.setItem('favorites', JSON.stringify(favorites));
                alert('تمت الإضافة إلى المفضلة');
            } else {
                alert('العمل موجود بالفعل في المفضلة');
            }
        }

        function addToWatchHistory(id, title, posterPath, type) {
            const item = { id, title, posterPath, type, date: new Date().toISOString() };
            watchHistory = watchHistory.filter(w => !(w.id === id && w.type === type));
            watchHistory.push(item);
            if (watchHistory.length > 20) watchHistory.shift();
            localStorage.setItem('watchHistory', JSON.stringify(watchHistory));
        }
    </script>
</body>
</html>